version: '2'
services:
  nginx:
    build: ./docker/nginx-fpm
    image: schoren/nginx-fpm
    container_name: web
    links:
      - phpfpm
    ports:
      - "8000:80"
    volumes:
      - ./app:/var/www/html

  phpfpm:
    build: ./docker/php56
    image: schoren/php56
    container_name: fpm
    links:
      - pgsql
      - mysql
      - memcached
      - redis
    volumes:
      - ./app:/var/www/html
    environment:
      PG_HOST: pgsql
      MYSQL_HOST: mysql
      MEMCACHED_HOST: memcached
      REDIS_HOST: redis

  pgsql:
    image: postgres
    container_name: postgres
    volumes:
      - /var/lib/postgresql/data
    environment:
      POSTGRES_USER: app
      POSTGRES_DB: app
      POSTGRES_PASSWORD: 123

  mysql:
    image: mariadb
    container_name: mysql
    volumes:
      - /var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: 123
      MYSQL_DATABASE: app
      MYSQL_USER: app
      MYSQL_PASSWORD: 123

  memcached:
    image: memcached
    container_name: memcached

  redis:
    build: docker/redis
    image: schoren/redis
    container_name: redis
    volumes:
      - /data